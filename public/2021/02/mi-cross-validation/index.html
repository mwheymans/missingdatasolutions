<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.83.1 with theme Tranquilpeak 0.4.8-BETA">
<meta name="author" content="Martijn W Heymans">
<meta name="keywords" content="">
<meta name="description" content="



With the function psfmi_perform of the psfmi package it is possible to combine Cross-validation with Multiple Imputation for internal validation.
">


<meta property="og:description" content="



With the function psfmi_perform of the psfmi package it is possible to combine Cross-validation with Multiple Imputation for internal validation.
">
<meta property="og:type" content="article">
<meta property="og:title" content="Multiple Imputation and Cross-validation">
<meta name="twitter:title" content="Multiple Imputation and Cross-validation">
<meta property="og:url" content="https://missingdatasolutions.rbind.io/2021/02/mi-cross-validation/">
<meta property="twitter:url" content="https://missingdatasolutions.rbind.io/2021/02/mi-cross-validation/">
<meta property="og:site_name" content="Missing Data Solutions">
<meta property="og:description" content="



With the function psfmi_perform of the psfmi package it is possible to combine Cross-validation with Multiple Imputation for internal validation.
">
<meta name="twitter:description" content="



With the function psfmi_perform of the psfmi package it is possible to combine Cross-validation with Multiple Imputation for internal validation.
">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2021-02-04T00:00:00">
  
  
    <meta property="article:modified_time" content="2021-02-04T00:00:00">
  
  
  
  
    
      <meta property="article:tag" content="Multiple Imputation">
    
      <meta property="article:tag" content="Cross-validation">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://missingdatasolutions.rbind.io/images/vignette_MI_cv.png">
  <meta property="twitter:image" content="https://missingdatasolutions.rbind.io/images/vignette_MI_cv.png">





  <meta property="og:image" content="https://missingdatasolutions.rbind.io/images/Martijn_photo.jpg">
  <meta property="twitter:image" content="https://missingdatasolutions.rbind.io/images/Martijn_photo.jpg">


    <title>Multiple Imputation and Cross-validation</title>

    <link rel="icon" href="https://missingdatasolutions.rbind.io/favicon.png">
    

    

    <link rel="canonical" href="https://missingdatasolutions.rbind.io/2021/02/mi-cross-validation/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://missingdatasolutions.rbind.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-127301719-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://missingdatasolutions.rbind.io/">Missing Data Solutions</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://missingdatasolutions.rbind.io/#about">
    
    
    
      
        <img class="header-picture" src="https://missingdatasolutions.rbind.io/images/Martijn_photo.jpg" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://missingdatasolutions.rbind.io/#about">
          <img class="sidebar-profile-picture" src="https://missingdatasolutions.rbind.io/images/Martijn_photo.jpg" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Martijn W Heymans</h4>
        
          <h5 class="sidebar-profile-bio">Associate Professor of Applied Biostatistics | Department of Epidemiology and Data Science | Courses: <a href="https://www.epidm.nl/en/course/missing-data-consequences-and-solutions/">Missing Data</a> and <a href="https://www.epidm.nl/en/course/clinical-prediction-models/">Prediction Models and Machine Learning</a> | <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=heymans+m">Publications</a> | email: <a href="mailto:mw.heymans@amsterdamumc.nl">mw.heymans@amsterdamumc.nl</a></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/post/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Posts</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://bookdown.org/mwheymans/bookmi/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-book"></i>
      
      <span class="sidebar-button-desc">Missing Data Book</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/shiny/">
    
      <i class="sidebar-button-icon fa fa-lg fa-play"></i>
      
      <span class="sidebar-button-desc">Learning Apps</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/news/">
    
      <i class="sidebar-button-icon fa fa-newspaper-o fa-lg"></i>
      
      <span class="sidebar-button-desc">News</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/mwheymans" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://missingdatasolutions.rbind.io/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Multiple Imputation and Cross-validation
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2021-02-04T00:00:00Z">
        
  February 4, 2021

      </time>
    
    
  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              </p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This page contains information of three methods that are implemented
in the <a href="https://github.com/mwheymans/psfmi"><code>psfmi</code></a> package and that combine Multiple Imputation with Cross-validation for the validation of logistic prediction models. Currently the methods are only available via downloading the
<code>psfmi</code> package via Github. Do this:</p>
<p>install.packages(“devtools”)</p>
<p>library(devtools)</p>
<p>devtools::install_github(“mwheymans/psfmi”)</p>
<p>library(psfmi)</p>
<p>The cross-validation methods are adjustments of the methods described in the
paper of <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/bimj.201800289">Mertens BJ</a> and <a href="https://journals.sagepub.com/doi/abs/10.1177/0049124115610345">Miles A</a>.</p>
<p>The methods are implemented in the function <code>psfmi_perform</code> and are called:
<code>cv_MI</code>, <code>cv_MI_RR</code> and <code>MI_cv_naive</code>. An explanation and examples of how to use the
methods can be found below. See also these Vignettes for more explanation of the methods <a href="https://mwheymans.github.io/psfmi/">Vignettes</a>.</p>
</div>
<div id="methods" class="section level1">
<h1>Methods</h1>
<ul>
<li><a href="#method-cv_mi">Method cv_MI</a></li>
<li><a href="#method-cv_mi_rr">Method cv_MI_RR</a></li>
<li><a href="#method-mi_cv_naive">Method MI_cv_naive</a></li>
</ul>
</div>
<div id="examples" class="section level1">
<h1>Examples</h1>
<ul>
<li><a href="#method-cv_mi---example-1">Method cv_MI - Example 1</a></li>
<li><a href="#method-cv_mi-including-bw-selection---example-2">Method cv_MI including BW selection - Example 2</a></li>
<li><a href="#method-cv_mi_rr---example-1">Method cv_MI_RR - Example 1</a></li>
<li><a href="#method-cv_mi_rr-including-bw-selection---example-2">Method cv_MI_RR including BW selection - Example 2</a></li>
<li><a href="#method-mi_cv_naive---example-1">Method MI_cv_naive - Example 1</a></li>
<li><a href="#method-mi_cv_naive-including-bw-selection---example-2">Method MI_cv_naive including BW selection - Example 2</a></li>
</ul>
<div id="method-cv_mi" class="section level2">
<h2>Method cv_MI</h2>
<p>With this method imputations are implemented as part of the cross-validation
procedure. Within each cross-validation fold, imputation
is done once. By repeating this process over multiple imputation runs,
multiply imputed training and test sets are generated. Model performance
is evaluated and tested in the training and test sets respectively.
The method can be performed in combination with backward selection
in the training set and subsequently testing the performance in the test set.
The method can only be performed when the outcome data is complete and
the original data, that contains the missing values has to be included.</p>
<div class="figure">
<img src="https://missingdatasolutions.rbind.io/post/2020-2-07-MI_cross_validation_files/cv_mi.jpg" alt="" />
<p class="caption">Schematic Overview of Method cv_MI</p>
</div>
<p>Back to <a href="#methods">Methods</a></p>
<div id="method-cv_mi---example-1" class="section level3">
<h3>Method cv_MI - Example 1</h3>
<p>To run the cv_MI method use:</p>
<pre class="r"><code>library(psfmi)</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;car&#39;:
##   method                          from
##   influence.merMod                lme4
##   cooks.distance.influence.merMod lme4
##   dfbeta.influence.merMod         lme4
##   dfbetas.influence.merMod        lme4</code></pre>
<pre class="r"><code>pool_lr &lt;- psfmi_lr(data=lbpmilr, formula = Chronic ~ Pain + JobDemands + rcs(Tampascale, 3) +
                   factor(Satisfaction) + Smoking, p.crit = 1, direction=&quot;FW&quot;,
                 nimp=5, impvar=&quot;Impnr&quot;, method=&quot;D1&quot;)

res_cv &lt;- psfmi_perform(pool_lr, val_method = &quot;cv_MI&quot;, data_orig = lbp_orig, folds=3,
                     nimp_cv = 2, p.crit=0.2, BW=TRUE, anova_test = &quot;LRT&quot;,
                     miceImp = miceImp, printFlag = FALSE)</code></pre>
<pre><code>## 
## Imp run 1</code></pre>
<pre><code>## 
## fold 1</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - rcs(Tampascale,3)</code></pre>
<pre><code>## Removed at Step 3 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 2</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 3</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## Imp run 2</code></pre>
<pre><code>## 
## fold 1</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 2</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 3</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre class="r"><code>res_cv</code></pre>
<pre><code>## $pool_stats
##                  Train      Test
## AUC          0.8971709 0.8433000
## Scaled Brier 0.4871927 0.3341000
## R2           0.5892451 0.4623542
## 
## $LP_val
## (Intercept)     lp_test 
##  0.06984537  0.75739579 
## 
## $auc_test
##             95% Low    AUC 95% Up
## AUC (logit)  0.7634 0.8433 0.8998</code></pre>
<p>Back to <a href="#examples">Examples</a></p>
</div>
<div id="method-cv_mi-including-bw-selection---example-2" class="section level3">
<h3>Method cv_MI including BW selection - Example 2</h3>
<p>To run the cv_MI method including BW selection use:</p>
<pre class="r"><code>library(psfmi)
pool_lr &lt;- psfmi_lr(data=lbpmilr, formula = Chronic ~ Pain + JobDemands + rcs(Tampascale, 3) +
                   factor(Satisfaction) + Smoking, p.crit = 1, direction=&quot;FW&quot;,
                 nimp=5, impvar=&quot;Impnr&quot;, method=&quot;D1&quot;)

res_cv &lt;- psfmi_perform(pool_lr, val_method = &quot;cv_MI&quot;, data_orig = lbp_orig, folds=3,
                     nimp_cv = 2, p.crit=0.2, BW=TRUE, anova_test = &quot;LRT&quot;,
                     miceImp = miceImp, printFlag = FALSE)</code></pre>
<pre><code>## 
## Imp run 1</code></pre>
<pre><code>## 
## fold 1</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 2</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 3</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## Imp run 2</code></pre>
<pre><code>## 
## fold 1</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 2</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 3</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - rcs(Tampascale,3)</code></pre>
<pre><code>## Removed at Step 3 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre class="r"><code>res_cv</code></pre>
<pre><code>## $pool_stats
##                  Train      Test
## AUC          0.8942859 0.8454000
## Scaled Brier 0.4681196 0.3375954
## R2           0.5719065 0.4746996
## 
## $LP_val
## (Intercept)     lp_test 
##  0.03880662  0.84650684 
## 
## $auc_test
##             95% Low    AUC 95% Up
## AUC (logit)  0.7416 0.8454 0.9124</code></pre>
<p>Back to <a href="#examples">Examples</a></p>
</div>
</div>
<div id="method-cv_mi_rr" class="section level2">
<h2>Method cv_MI_RR</h2>
<p>The method cv_MI_RR uses multiple imputation within the cross-validation
definition. The pooled model is analyzed in the training data and
subsequently tested in the test data. The method can be performed
in combination with backward selection of the pooled model in the training set
and subsequently testing the performance of the pooled model in the test set.
The method can only be performed when the outcome data is complete.</p>
<div class="figure">
<img src="https://missingdatasolutions.rbind.io/post/2020-2-07-MI_cross_validation_files/cv_mi_RR.jpg" alt="" />
<p class="caption">Schematic Overview of Method cv_MI_RR.</p>
</div>
<p>Back to <a href="#methods">Methods</a></p>
<div id="method-cv_mi_rr---example-1" class="section level3">
<h3>Method cv_MI_RR - Example 1</h3>
<p>To run the cv_MI method use:</p>
<pre class="r"><code>library(psfmi)
pool_lr &lt;- psfmi_lr(data=lbpmilr, formula = Chronic ~ Pain + JobDemands + rcs(Tampascale, 3) +
                   factor(Satisfaction) + Smoking, p.crit = 1, direction=&quot;FW&quot;,
                 nimp=5, impvar=&quot;Impnr&quot;, method=&quot;D1&quot;)

res_cv &lt;- psfmi_perform(pool_lr, val_method = &quot;cv_MI_RR&quot;, data_orig = lbp_orig, 
                        folds = 4, nimp_mice = 5, p.crit=0.2, BW=TRUE, 
                        miceImp = miceImp, printFlag = FALSE)</code></pre>
<pre><code>## 
## fold 1</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 2</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 3</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 4</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre class="r"><code>res_cv</code></pre>
<pre><code>## $stats
##                  Train      Test
## AUC          0.8961433 0.8562267
## Brier scaled 0.4651623 0.3008909
## Rsq          0.5776141 0.5816360
## 
## $slope
##  Intercept      Slope 
## 0.07361578 0.84008113</code></pre>
<p>Back to <a href="#examples">Examples</a></p>
</div>
<div id="method-cv_mi_rr-including-bw-selection---example-2" class="section level3">
<h3>Method cv_MI_RR including BW selection - Example 2</h3>
<p>To run the cv_MI_RR method including backward selection:</p>
<pre class="r"><code>library(psfmi)
pool_lr &lt;- psfmi_lr(data=lbpmilr, formula = Chronic ~ Pain + JobDemands + rcs(Tampascale, 3) +
                   factor(Satisfaction) + Smoking, p.crit = 1, direction=&quot;FW&quot;,
                 nimp=5, impvar=&quot;Impnr&quot;, method=&quot;D1&quot;)

res_cv &lt;- psfmi_perform(pool_lr, val_method = &quot;cv_MI_RR&quot;, data_orig = lbp_orig, 
                        folds = 4, nimp_mice = 5, p.crit=0.2, BW=TRUE, 
                        miceImp = miceImp, printFlag = FALSE)</code></pre>
<pre><code>## 
## fold 1</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 2</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - rcs(Tampascale,3)</code></pre>
<pre><code>## Removed at Step 3 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 3</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## fold 4</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre class="r"><code>res_cv</code></pre>
<pre><code>## $stats
##                  Train      Test
## AUC          0.8864668 0.8380625
## Brier scaled 0.4635775 0.3267663
## Rsq          0.5611362 0.4378292
## 
## $slope
##  Intercept      Slope 
## -0.1363122  0.7899024</code></pre>
<p>Back to <a href="#examples">Examples</a></p>
</div>
</div>
<div id="method-mi_cv_naive" class="section level2">
<h2>Method MI_cv_naive</h2>
<p>This method applies cross-validation after Multiple Imputation. The same folds
are used in each multiply imputed dataset. Is is possible to do backward
selection during cross-validation. How this method works is visualized below.</p>
<div class="figure">
<img src="https://missingdatasolutions.rbind.io/post/2020-2-07-MI_cross_validation_files/MI_cv_naive.jpg" alt="" />
<p class="caption">Schematic Overview of Method MI_cv_naive.</p>
</div>
<p>Back to <a href="#methods">Methods</a></p>
<div id="method-mi_cv_naive---example-1" class="section level3">
<h3>Method MI_cv_naive - Example 1</h3>
<p>To run the MI_cv_naive method use:</p>
<pre class="r"><code>library(psfmi)
pool_lr &lt;- psfmi_lr(data=lbpmilr, formula = Chronic ~ Pain + JobDemands + rcs(Tampascale, 3) +
                   factor(Satisfaction) + Smoking, p.crit = 1, direction=&quot;FW&quot;,
                 nimp=5, impvar=&quot;Impnr&quot;, method=&quot;D1&quot;)

res_cv &lt;- psfmi_perform(pool_lr, val_method = &quot;MI_cv_naive&quot;, folds=3, p.crit=1, BW=FALSE)</code></pre>
<pre><code>## 
## Imputation 1</code></pre>
<pre><code>## 
## Imputation 2</code></pre>
<pre><code>## 
## Imputation 3</code></pre>
<pre><code>## 
## Imputation 4</code></pre>
<pre><code>## 
## Imputation 5</code></pre>
<pre class="r"><code>res_cv</code></pre>
<pre><code>## $cv_stats
##                  Train      Test
## AUC          0.8920379 0.8410000
## Brier scaled 0.4606837 0.3227124
## R-squared    0.5717383 0.5117027
## 
## $auc_test
##             95% Low   AUC 95% Up
## AUC (logit)  0.7602 0.841 0.8982
## 
## $test_coef
##  Intercept      Slope 
## 0.03362436 0.89480356</code></pre>
<p>Back to <a href="#examples">Examples</a></p>
</div>
<div id="method-mi_cv_naive-including-bw-selection---example-2" class="section level3">
<h3>Method MI_cv_naive including BW selection - Example 2</h3>
<p>To run the MI_cv_naive method by implementing backward variable selection during cross-validation use:</p>
<pre class="r"><code>library(psfmi)
pool_lr &lt;- psfmi_lr(data=lbpmilr, formula = Chronic ~ Pain + JobDemands + rcs(Tampascale, 3) +
                   factor(Satisfaction) + Smoking, p.crit = 1, direction=&quot;FW&quot;,
                 nimp=5, impvar=&quot;Impnr&quot;, method=&quot;D1&quot;)

res_cv &lt;- psfmi_perform(pool_lr, val_method = &quot;MI_cv_naive&quot;, folds=3, p.crit=0.05, BW=TRUE)</code></pre>
<pre><code>## 
## Imputation 1</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## Imputation 2</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - rcs(Tampascale,3)</code></pre>
<pre><code>## Removed at Step 3 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - factor(Satisfaction)</code></pre>
<pre><code>## Removed at Step 4 is - Pain</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## Imputation 3</code></pre>
<pre><code>## Removed at Step 1 is - Smoking</code></pre>
<pre><code>## Removed at Step 2 is - JobDemands</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - Pain</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## Imputation 4</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## 
## Imputation 5</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - rcs(Tampascale,3)</code></pre>
<pre><code>## Removed at Step 3 is - Smoking</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre><code>## Removed at Step 1 is - JobDemands</code></pre>
<pre><code>## Removed at Step 2 is - Smoking</code></pre>
<pre><code>## Removed at Step 3 is - rcs(Tampascale,3)</code></pre>
<pre><code>## 
## Selection correctly terminated, 
## No more variables removed from the model</code></pre>
<pre class="r"><code>res_cv</code></pre>
<pre><code>## $cv_stats
##                  Train      Test
## AUC          0.8801651 0.8370000
## Brier scaled 0.4477188 0.3724069
## R-squared    0.5402726 0.4857196
## 
## $auc_test
##             95% Low   AUC 95% Up
## AUC (logit)  0.7479 0.837 0.8989
## 
## $test_coef
##   Intercept       Slope 
## -0.03830607  0.98729949</code></pre>
<p>Back to <a href="#examples">Examples</a></p>
</div>
</div>
</div>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://missingdatasolutions.rbind.io/tags/multiple-imputation/">Multiple Imputation</a>

  <a class="tag tag--primary tag--small" href="https://missingdatasolutions.rbind.io/tags/cross-validation/">Cross-validation</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://missingdatasolutions.rbind.io/2021/02/cox-external-validation/" data-tooltip="External validation of a Cox prognostic model">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://missingdatasolutions.rbind.io/2021/01/steps-to-externally-validate-a-prediction-model/" data-tooltip="Steps to externally validate a prediction model">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://missingdatasolutions.rbind.io/2021/02/mi-cross-validation/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2025 Martijn W Heymans. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://missingdatasolutions.rbind.io/2021/02/cox-external-validation/" data-tooltip="External validation of a Cox prognostic model">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://missingdatasolutions.rbind.io/2021/01/steps-to-externally-validate-a-prediction-model/" data-tooltip="Steps to externally validate a prediction model">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://missingdatasolutions.rbind.io/2021/02/mi-cross-validation/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fmissingdatasolutions.rbind.io%2F2021%2F02%2Fmi-cross-validation%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://missingdatasolutions.rbind.io/images/Martijn_photo.jpg" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Martijn W Heymans</h4>
    
      <div id="about-card-bio">Associate Professor of Applied Biostatistics | Department of Epidemiology and Data Science | Courses: <a href="https://www.epidm.nl/en/course/missing-data-consequences-and-solutions/">Missing Data</a> and <a href="https://www.epidm.nl/en/course/clinical-prediction-models/">Prediction Models and Machine Learning</a> | <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term=heymans+m">Publications</a> | email: <a href="mailto:mw.heymans@amsterdamumc.nl">mw.heymans@amsterdamumc.nl</a></div>
    
    
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://missingdatasolutions.rbind.io/images/cover_water.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://missingdatasolutions.rbind.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/missingdatasolutions.rbind.io\/2021\/02\/mi-cross-validation\/';
          
            this.page.identifier = '\/2021\/02\/mi-cross-validation\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'http-missingdatasolutions-rbind-io';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  


  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      CommonHTML: { linebreaks: { automatic: true } },
      tex2jax: { inlineMath: [ ['$', '$'], ['\\(','\\)'] ], displayMath: [ ['$$','$$'], ['\\[', '\\]'] ], processEscapes: false },
      messageStyle: 'none'
    });
  </script>



    
  </body>
</html>

